{"version":3,"sources":["components/Dialogs/Dialogs.module.css","components/Dialogs/Dialogs.jsx","hoc/withAuthRedirect.jsx","components/Dialogs/DialogsContainer.jsx"],"names":["module","exports","Dialogs","props","dialogs","dialogsPage","curDlg","currentDialog","curDlgBlock","React","useRef","sendMsgBtn","createRef","newMsgField","enterKeyDown","onSendMsg","msgText","current","value","sendMsg","focus","onEnterKeyDown","e","code","disabled","document","activeElement","preventDefault","setTimeout","onEnterKeyUp","useEffect","addEventListener","scrollTop","scrollHeight","onSetCurDlg","dlg","currentTarget","textContent","setCurDlg","DialogItem","path","id","className","classes","dialog","to","activeClassName","active","onClick","src","ava","dialog__img","name","dialogsBlock","map","i","Msg","style","outgoing","incoming","msgs","MsgElements","filter","msg","text","out","Messages","messages","ref","EmptyMessagesDiv","fullHeightMessages","noDlg","MessageItems","render","component","messagesBlock","DialogForm","initialValues","values","handleChange","errors","touched","handleBlur","isSubmitting","handleSubmit","writeMsg","placeholder","onChange","onBlur","startsWith","writeMsgText","autoFocus","type","writeMsgBtn","match","commonWrap","dialogsWrap","messagesWrap","mapStatetoPropsForRedirect","state","isAuth","auth","compose","connect","dispatch","sendMessageAC","setCurrentDialogAC","Component","RedirectComponent","this"],"mappings":"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","file":"static/js/4.2a44f92a.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"commonWrap\":\"Dialogs_commonWrap__2vYTk\",\"dialogsWrap\":\"Dialogs_dialogsWrap__BSdra\",\"dialogs\":\"Dialogs_dialogs__1I3Ut\",\"dialog\":\"Dialogs_dialog__2ahLy\",\"active\":\"Dialogs_active__3xG4Q\",\"dialog__img\":\"Dialogs_dialog__img__x1-Fj\",\"messagesWrap\":\"Dialogs_messagesWrap__2VqBb\",\"writeMsg\":\"Dialogs_writeMsg__KqPRz\",\"writeMsgText\":\"Dialogs_writeMsgText__2eYY2\",\"writeMsgBtn\":\"Dialogs_writeMsgBtn__sFsG3\",\"messages\":\"Dialogs_messages__3rDHn\",\"fullHeightMessages\":\"Dialogs_fullHeightMessages__1STKv\",\"outgoing\":\"Dialogs_outgoing__1p9tq\",\"incoming\":\"Dialogs_incoming__VBKpg\",\"noDlg\":\"Dialogs_noDlg__25ZAv\"};","import React, { useState, useEffect } from 'react';\r\nimport classes from './Dialogs.module.css';\r\nimport { Redirect, Route, NavLink } from 'react-router-dom';\r\nimport { Formik } from 'formik';\r\n\r\n\r\nconst Dialogs = (props) => {\r\n\r\n\tlet dialogs = props.dialogsPage;\r\n\tlet curDlg = props.currentDialog;\r\n\tlet curDlgBlock = React.useRef();\r\n\tlet sendMsgBtn = React.createRef();\r\n\tlet newMsgField = React.useRef();\r\n\tlet enterKeyDown = false;\r\n\r\n\tlet onSendMsg = () => {\r\n\t\tlet msgText = newMsgField.current.value;\r\n\t\tprops.sendMsg(msgText);\r\n\r\n\t\tnewMsgField.current.value = '';\r\n\t\tnewMsgField.current.focus();\r\n\t}\r\n\r\n\tlet onEnterKeyDown = (e) => {\r\n\t\tif (e.code == 'Enter' && sendMsgBtn.current\r\n\t\t\t&& !sendMsgBtn.current.disabled && !enterKeyDown\r\n\t\t\t&& document.activeElement == newMsgField.current) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tenterKeyDown = true;\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tonSendMsg();\r\n\t\t\t\t}, 60);\t\r\n\t\t\t// onSendMsg();\r\n\t\t}\r\n\t}\r\n\r\n\tlet onEnterKeyUp = (e) => {\r\n\t\tif (e.code == 'Enter' && sendMsgBtn.current && !sendMsgBtn.current.disabled\r\n\t\t\t&& enterKeyDown && document.activeElement == newMsgField.current) {\r\n\t\t\tenterKeyDown = false;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.addEventListener('keydown', onEnterKeyDown)\r\n\t});\r\n\r\n\tuseEffect(() => {\r\n\t\tdocument.addEventListener('keyup', onEnterKeyUp)\r\n\t});\r\n\r\n\tuseEffect(() => {\r\n\t\tif (curDlg) {\r\n\t\t\tcurDlgBlock.current.scrollTop = curDlgBlock.current.scrollHeight;\r\n\t\t}\r\n\t})\r\n\r\n\r\n\tlet onSetCurDlg = (e) => {\r\n\t\tlet dlg = e.currentTarget.textContent;\r\n\t\tprops.setCurDlg(dlg);\r\n\t}\r\n\r\n\r\n\tconst DialogItem = (props) => {\r\n\t\tlet path = `/dialogs/${props.id}`;\r\n\r\n\t\treturn (\r\n\t\t\t<li className={classes.dialog} >\r\n\t\t\t\t<NavLink to={path} activeClassName={classes.active} onClick={onSetCurDlg}>\r\n\t\t\t\t\t<img src={props.ava} className={classes.dialog__img} />\r\n\t\t\t\t\t{props.name}\r\n\t\t\t\t</NavLink>\r\n\t\t\t</li>\r\n\t\t)\r\n\t}\r\n\r\n\r\n\tlet dialogsBlock = dialogs\r\n\t\t.map((dialog, i) => <DialogItem name={dialog.name} id={dialog.id} ava={dialog.ava} key={dialog.id} />)\r\n\r\n\r\n\tlet Msg = (props) => {\r\n\t\tlet style = props.style ? classes.outgoing : classes.incoming;\r\n\r\n\t\treturn (\r\n\t\t\t<div className={style}>{props.msgs}</div>\r\n\t\t)\r\n\t}\r\n\r\n\r\n\tlet MsgElements = curDlg ?\r\n\t\tdialogs\r\n\t\t\t.filter(dialog => dialog.name == curDlg)[0].msgs\r\n\t\t\t.map(msg => <Msg msgs={msg.text} style={msg.out} key={msg.id} />)\r\n\t\t: null;\r\n\r\n\r\n\tlet Messages = () => {\r\n\t\treturn (\r\n\t\t\t<div className={classes.messages} ref={curDlgBlock}>\r\n\t\t\t\t{MsgElements}\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n\r\n\tlet EmptyMessagesDiv = () => {\r\n\t\treturn (\r\n\t\t\t<div className={classes.fullHeightMessages}>\r\n\t\t\t\t<div className={classes.noDlg}>\r\n\t\t\t\t\t<p>Диалог не выбран</p>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n\r\n\r\n\tlet MessageItems = (props) => {\r\n\t\tlet path = `/dialogs/${props.path}`;\r\n\t\tlet component = () => props.component;\r\n\r\n\t\treturn (\r\n\t\t\t<Route path={path} render={component} />\r\n\t\t)\r\n\t}\r\n\r\n\tlet messagesBlock = !curDlg ? <EmptyMessagesDiv />\r\n\t\t: dialogs.map((dialog) => <MessageItems path={dialog.id} component={<Messages />} key={dialog.id} />)\r\n\r\n\r\n\tconst DialogForm = (props) => {\r\n\t\treturn (\r\n\t\t\t<Formik\r\n\t\t\t\tinitialValues={{ msgText: '' }}\r\n\t\t\t>\r\n\t\t\t\t{({\r\n\t\t\t\t\tvalues,\r\n\t\t\t\t\terrors,\r\n\t\t\t\t\ttouched,\r\n\t\t\t\t\thandleChange,\r\n\t\t\t\t\thandleBlur,\r\n\t\t\t\t\thandleSubmit,\r\n\t\t\t\t\tisSubmitting\r\n\t\t\t\t}) => (\r\n\t\t\t\t\t<form className={classes.writeMsg}>\r\n\r\n\t\t\t\t\t\t<textarea\r\n\t\t\t\t\t\t\tname={'msgText'}\r\n\t\t\t\t\t\t\tid={'msgText'}\r\n\t\t\t\t\t\t\tplaceholder={\"write message text\"}\r\n\t\t\t\t\t\t\tonChange={handleChange}\r\n\t\t\t\t\t\t\tonBlur={handleBlur}\r\n\t\t\t\t\t\t\tvalue={(values.msgText).startsWith('\\n') ? '' : values.msgText}\r\n\t\t\t\t\t\t\t// className={touched.name && errors.name ? classes.test : null}\r\n\t\t\t\t\t\t\tclassName={classes.writeMsgText}\r\n\t\t\t\t\t\t\tref={newMsgField}\r\n\t\t\t\t\t\t\tautoFocus\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<button type={'submit'} className={classes.writeMsgBtn} ref={sendMsgBtn}\r\n\t\t\t\t\t\t\tdisabled={isSubmitting || values.msgText == '' || !(values.msgText).match(/\\S/g)}\r\n\t\t\t\t\t\t\tonClick={onSendMsg}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tSend\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</form>\r\n\t\t\t\t)}\r\n\t\t\t</Formik>\r\n\t\t)\r\n\t}\r\n\r\n\r\n\treturn (\r\n\t\t<div className={classes.commonWrap}>\r\n\t\t\t<div className={classes.dialogsWrap}>\r\n\t\t\t\t<ul className={classes.dialogs}>\r\n\t\t\t\t\t{dialogsBlock}\r\n\t\t\t\t</ul>\r\n\t\t\t</div>\r\n\t\t\t<div className={classes.messagesWrap}>\r\n\t\t\t\t{messagesBlock}\r\n\t\t\t\t{curDlg && <DialogForm />}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\nexport default Dialogs;","import React from 'react';\r\nimport { Redirect } from 'react-router-dom';\r\nimport { connect } from 'react-redux';\r\n\r\nlet mapStatetoPropsForRedirect = (state) => ({\r\n\tisAuth: state.auth.isAuth\r\n})\r\n\r\nexport const withAuthRedirect = (Component) => {\r\n\tclass RedirectComponent extends React.Component {\r\n\t\trender() {\r\n\t\t\tif (!this.props.isAuth) return <Redirect to='/login' />\r\n\t\t\treturn <Component {...this.props}/>\r\n\t\t}\r\n\t}\r\n\r\n\tlet connectAuthRedirectComponent = connect(mapStatetoPropsForRedirect)(RedirectComponent)\r\n\treturn connectAuthRedirectComponent;\r\n}","import React from 'react';\r\nimport { sendMessageAC, updateNewMsgTextAC, setCurrentDialogAC } from '../../redux/dialogs-reducer';\r\nimport Dialogs from './Dialogs';\r\nimport { connect } from 'react-redux';\r\nimport { withAuthRedirect } from '../../hoc/withAuthRedirect';\r\nimport { compose } from 'redux';\r\n\r\n\r\nlet mapStateToProps = (state) => {\r\n\t\r\n\treturn {\r\n\t\tdialogsPage: state.dialogsPage.dialogs,\r\n\t\tcurrentDialog: state.dialogsPage.currentDialog,\r\n\t}\r\n}\r\n\r\nlet mapDispatchToProps = (dispatch) => {\r\n\treturn {\r\n\t\tsendMsg: (msgText) => {\r\n\t\t\tdispatch(sendMessageAC(msgText))\r\n\t\t},\r\n\t\tsetCurDlg: (dialog) => {\r\n\t\t\tdispatch(setCurrentDialogAC(dialog))\r\n\t\t},\r\n\t}\r\n}\r\n\r\nexport default compose(\r\n\tconnect(mapStateToProps, mapDispatchToProps),\r\n\twithAuthRedirect\r\n)(Dialogs);\r\n\r\n"],"sourceRoot":""}